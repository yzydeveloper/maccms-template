<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>会员注册 - 个人中心 - {$maccms.site_name}</title>
    <meta name="keywords" content="个人中心,{$maccms.site_keywords}"/>
    <meta name="description" content="{$maccms.site_description}"/>
    {include file="public/top"}
</head>
<body>
<div class="login-page">
    <div class="container">
        <div class="top">
            <div class="user-title">账号注册</div>
            <div class="desc">注册一个属于自己的账号！</div>
        </div>
        <div class="login-main">
            <div class="login-card">
                <form class="user-form" action="" method="post" id="fm">
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe652;</i></div>
                        <input type="text" name="user_name" id="user_name" placeholder="请输入账号" maxlength="30">
                    </div>
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe62a;</i></div>
                        <input type="password" name="user_pwd" id="user_pwd" placeholder="请输入密码" maxlength="20">
                    </div>
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe62a;</i></div>
                        <input type="password" name="user_pwd2" id="user_pwd2" placeholder="请输确认入密码" maxlength="20">
                    </div>
                    {if condition="$user_config.reg_phone_sms neq 0"}
                    <input type="hidden" name="ac" value="phone">
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe6df;</i></div>
                        <input type="password" name="to" id="to" placeholder="输入手机号" maxlength="20">
                    </div>
                    <div class="form-control">
                        <input type="password" name="code" id="code" placeholder="请输入手机验证码" maxlength="20">
                        <a href="javascript:" id="btn_send_sms" class="smg bnt">获取验证码</a>
                    </div>
                    {elseif condition="$user_config.reg_email_sms neq 0"}
                    <input type="hidden" name="ac" value="email">
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe6df;</i></div>
                        <input type="password" name="to" id="to" placeholder="请输入邮箱" maxlength="20">
                    </div>
                    <div class="form-control">
                        <input type="password" name="code" id="code" placeholder="请输入邮箱验证码" maxlength="20">
                        <a href="javascript:" id="btn_send_sms" class="smg bnt">获取验证码</a>
                    </div>
                    {/if}
                    {if condition="$user_config.reg_verify neq 0"}
                    <div class="form-control flex">
                        <input style="height:39px;" maxlength="4" type="tel" name="verify" id="verify"
                               placeholder="请输入验证码"/>
                        <img style="border-radius:6px;" height="45" src="{:mac_url('verify/index')}" id="verify_img"
                             onclick="this.src=this.src+'?'" title="看不清楚? 换一张！"/>
                    </div>
                    {/if}
                    <div class="form-control">
                        <button type="button" id="btn_submit" class="bnt login-btn">注册</button>
                    </div>
                </form>
                <div class="flex between">
                    <a href="{:mac_url('user/login')}">立即登录</a>
                    <a href="{:mac_url('user/reg')}">注册账号</a>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var countdown = 60;

    function settime(val) {
        if (countdown == 0) {
            val.removeAttribute("disabled");
            val.value = "获取验证码";
            countdown = 60;
            return true;
        } else {
            val.setAttribute("disabled", true);
            val.value = "重新发送(" + countdown + ")";
            countdown--;
        }
        setTimeout(function () {
            settime(val)
        }, 1000)
    }

    $("body").bind('keyup', function (event) {
        if (event.keyCode == 13) {
            $('#btnLogin').click();
        }
    });

    $('#btn_send_sms').click(function () {
        var ac = $('input[name="ac"]').val();
        var to = $('input[name="to"]').val();
        if (ac == 'email') {
            var pattern = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            var ex = pattern.test(to);
            if (!ex) {
                EC.Pop.Msg('邮箱格式不正确', 2000);
                return;
            }
        } else if (ac == 'phone') {
            var pattern = /^[1][0-9]{10}$/;
            var ex = pattern.test(to);
            if (!ex) {
                EC.Pop.Msg('手机号格式不正确', 2000);
                return;
            }
        } else {
            EC.Pop.Msg('参数错误', 2000);
            return;
        }
        settime(this);
        var data = $("#fm").serialize();

        $.ajax({
            url: "{:mac_url('user/reg_msg')}",
            type: "post",
            dataType: "json",
            data: data,
            beforeSend: function () {
                //开启loading
            },
            success: function (r) {
                EC.Pop.Msg(r.msg, 2000);
            },
            complete: function () {
                //结束loading
            }
        });
    });
    $('#btn_submit').click(function () {
        if ($('#user_name').val() == '') {
            EC.Pop.Msg('请输入用户名！', 2000);
            $("#user_name").focus();
            return false;
        }
        if ($('#user_pwd').val() == '') {
            EC.Pop.Msg('请输入密码！', 2000);
            $("#user_pwd").focus();
            return false;
        }
        if ($('#verify').val() == '') {
            EC.Pop.Msg('请输入验证码！', 2000);
            $("#verify").focus();
            return false;
        }

        $.ajax({
            url: "{:mac_url('user/reg')}",
            type: "post",
            dataType: "json",
            data: $('#fm').serialize(),
            beforeSend: function () {
                $("#btn_submit").val("loading...");
            },
            success: function (r) {
                EC.Pop.Msg(r.msg, 2000);
                if (r.code == 1) {
                    location.href = "{:mac_url('index/index')}";
                } else {
                    $('#verify_img').click();
                }
            },
            complete: function () {
                $("#btn_submit").val("立即注册");
            }
        });
    });
</script>
</body>
</html>