<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>会员登录 - 个人中心 - {$maccms.site_name}</title>
    <meta name="keywords" content="个人中心,{$maccms.site_keywords}" />
    <meta name="description" content="{$maccms.site_description}" />
    {include file="public/top"}
</head>
<body>
<div class="login-page">
    <div class="container">
        <div class="top">
            <div class="user-title">会员登入</div>
            <div class="desc">{$maccms.site_name}</div>
        </div>
        <div class="login-main">
            <div class="login-card">
                <form class="user-form" action="" method="post" id="fm">
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe652;</i></div>
                        <input type="text" name="user_name" id="user_name" placeholder="请输入账号"  maxlength="30">
                    </div>
                    <div class="form-control">
                        <div class="r6"><i class="fa">&#xe62a;</i></div>
                        <input type="password" name="user_pwd" id="user_pwd" placeholder="请输入密码" maxlength="20">
                    </div>
                    {if condition="$GLOBALS['config']['user']['login_verify'] eq 1"}
                    <div class="form-control flex">
                        <input style="height:39px;" maxlength="4" type="tel" name="verify" id="verify" placeholder="请输入验证码" />
                        <img style="border-radius:6px;" height="45" src="{:mac_url('verify/index')}" id="verify_img" onclick="this.src=this.src+'?'" title="看不清楚? 换一张！" />
                    </div>
                    {/if}
                    <div class="form-control">
                        <button type="button" id="btn_submit" class="bnt login-btn">提交登录</button>
                    </div>
                </form>
                <div class="flex between">
                    <a href="{:mac_url('user/findpass_msg')}?ac=email">忘记密码</a>
                    <a href="{:mac_url('user/reg')}">注册账号</a>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        $("body").bind('keyup',function(event) {
            if(event.keyCode==13){ $('#btnLogin').click(); }
        });
        $('#btn_submit').click(function() {
            if ($('#user_name').val()  == '') { EC.Pop.Msg('请输入用户！',2000); $("#user_name").focus(); return false; }
            if ($('#user_pwd').val()  == '') { EC.Pop.Msg('请输入密码！',2000); $("#user_pwd").focus(); return false; }
            if ($('#verify').length> 0 && $('#verify').val()  == '') { EC.Pop.Msg('请输入验证码！',2000); $("#verify").focus(); return false; }

            $.ajax({
                url: "{:mac_url('user/login')}",
                type: "post",
                dataType: "json",
                data: $('#fm').serialize(),
                beforeSend: function () {
                    $("#btn_submit").val("loading...");
                },
                success: function (r) {
                    if(r.code==1){
                        location.href="{:mac_url('index/index')}";
                    }
                    else{
                        EC.Pop.Msg(r.msg,2000);
                        $('#verify_img').click();
                    }
                },
                complete: function () {
                    $("#btn_submit").val("立即登录");
                }
            });
        });
    });
</script>
</body>
</html>